# 4장 커넥션 관리

{% hint style="success" %}
Key Point
{% endhint %}

* Http는 어떻게 TCP 커넥션을 사용하는가?
* TCP 커넥션의 지연, 병목, 막힘
* 병렬 커넥션, keep-alive 커넥션, 커넥션 파이프라인을 활용한 HTTP의 최적화
* 커넥션 관리를 위해 따라야 할 규칙들



## TCP 커넥션

> 패킷 교환 네트워크 프로토콜들의 계층화된 집합인 TCP/IP를 통해 이루어진다.

### 1. 패킷 교환 네트워크 프로토콜이란?

{% hint style="success" %}
패킷 교환 네트워크 프로토콜은 데이터를 일정 크기의 작은 단위인 '패킷(Packet)'으로 분할해서, 각 **패킷이 네트워크를 통해 개별적으로 전송되는 방식을 따르는 통신 방법에서 사용하는 규약**이다.
{% endhint %}

#### 1) 패킷 교환 네트워크의 구조와 동작 원리

* 데이터를 송신 측에서 패킷으로 분할한다.
* 각 패킷에는 목적지 주소 등 제어 정보가 담긴 헤더가 붙는다.
* 패킷들은 서로 다른 경로로 독립적으로 전달될 수 있다.
* 수신 측에서는 패킷을 원래의 데이터로 재조립한다.

#### 2) 대표적인 패킷 교환 네트워크 프로토콜

* IP(Internet Protocol): 패킷의 전달 경로 지정과 목표지 주소 부여 등, 가장 근본적인 패킷 처리 규약.
* TCP(Transmission Control Protocol): 신뢰성 보장(데이터의 순서, 오류 검출 및 재전송 등)을 담당하며, IP 위에서 동작하는 상위 계층 프로토콜.
* UDP(User Datagram Protocol): 오류 제어나 순서 보장은 하지 않고 빠른 전송을 중시하는 비연결형 프로토콜.
* X.25: 전화망 기반 공중 데이터 교환망에서 사용된 초기 패킷 교환 프로토콜.

#### 3) 패킷 교환 프로토콜의 주요 특징

* 네트워크 자원을 효율적으로 공유할 수 있다.
* 대역폭을 여러 사용자가 효율적으로 나눠쓰기 적합하다.
* 장애 시 다른 경로로 **우회가 가능해 신뢰성이 높다.**
* 오늘날의 인터넷, 사설망(LAN/WAN) 등 거의 모든 컴퓨터 네트워크에서 표준으로 사용된다

> 즉, 패킷 교환 네트워크 프로토콜은 인터넷과 같은 네트워크에서 데이터를 쪼개어 전송·전달하고 재조합하는 규칙(대표적으로 TCP, IP, UDP, X.25 등)을 의미한다는 점이 핵심이다.

### 2. 커넥션이 맺어지고 난 후

#### 1)  3방향 핸드셰이크와 4방향 핸드셰이크

일단 커넥션이 맺어지면 클라이언트와 서버 컴퓨터 간에 주고받은 메시지들은 손실 혹은 손상되거나 순서가 바뀌지 않고 안전하게 전달된다.

1. 브라우저가 www.joes-hardware.com라는   &#x20;호스트 명을 추출한다.
2. 브라우저가 이 호스트 명에 대한 IP 주소를 찾는다.&#x20;
3. 브라우저가 포트 번호(80)을 얻는다.
4. 브라우저가 202.43.78.3의 80포트로   &#x20;`TCP 커넥션을 생성`한다.
5. 브라우저가 서버로 HTTP GET 요청 메시지를 보낸다.
6. 브라우저가 서버에서 온 HTTP 응답 메세지를 읽는다.
7. 브라우저가 커넥션을 끊는다.

{% hint style="danger" %}
우리는 이걸 3방향 핸드셰이크와 4방향 핸드셰이크라고 한다.
{% endhint %}

> TCP는 `3방향 핸드셰이크(3-way handshake)`라는 방식을 사용해 연결을 수립한다.&#x20;

세 가지 방식의 악수인데, 말 그대로 세 번의 메시지 교환을 통해 클라이언트와 서버가 서로 데이터를 주고받을 준비를 하는 과정을 말한다.

<figure><img src="../../../../.gitbook/assets/image (390).png" alt=""><figcaption></figcaption></figure>

Q. 주고받는 내용만 파악하면 될 것 같은데, 왜 상태까지 함께 확인하는&#x20;걸까?&#x20;

그 이유는 나중에 **실제 데이터를 송수신할 때 이 상태를 보고 전송 가능 여부를&#x20;파악**하기 때문이다. 마치 가게에서 밥을 먹으려고 하는데 문 앞에 ‘영업 종료’ 또는 ‘브레이크 타임’이라고 적혀 있으면 출입할 수 없고 ‘영업 중’이라고 적혀 있어야만 밥을 먹을 수 있는 것과 같다.



> TCP의 연결 종료 방식을 4방향 핸드셰이크(4-way handshake)

TCP 또한 더 이상 보낼 데이터가 없는데 연결을 지속하는 것은 비효율적이라고 생각해 데이터 통신이 끝나면 **연결을 끊는 과정**을 거친다.&#x20;

<figure><img src="../../../../.gitbook/assets/image (391).png" alt=""><figcaption></figcaption></figure>



#### 2) 신뢰할 수 있는 데이터 전송 통로인 TCP

HTTP 커넥션은 몇몇 사용 규칙을 제외하고는 TCP 커넥션에 불과하다. 그렇기에 TCP를 제대로 알아야 하는데 TCP는 HTTP에게 신뢰할 만한 통신 방식을 제공한다.&#x20;

**Q1. 그렇다면 신뢰성 있는 통신이란 무엇일까?**

컴퓨터 세상에서 신뢰성이 있다는 것은 **오류가 없다는 뜻**이다. 즉, 언제 어디서든 데이터를 온전히 가져다줄 거라는 믿음이 있는 것이다.

**Q2. TCP는 패킷의 유실 문제를 해결해주는데.. 어떤 방식으로 해결해줄까?**

어떤 패킷이 사라졌는지 파악하기 위해 **패킷마다 번호를 붙이고** 정확히 목적지에 도착했는지 확인하기 위해 **하나의 확인 절차**를 추가했다.



