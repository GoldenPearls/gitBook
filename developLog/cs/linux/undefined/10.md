---
icon: clock-ten-thirty
---

# 10장 가상화

## 1. 가상화 시스템의 구조 – 가짜가 진짜처럼 작동하는 원리

### 1) “한 기계 안에 또 다른 컴퓨터가 있다?” – 가상화란 무엇인가

요즘은 누구나 한 번쯤 이런 상황을 마주합니다:

* 윈도우에서 리눅스를 돌려본다든가,
* 개발 환경을 바꿔서 테스트하고 싶을 때,
* 클라우드에서 여러 운영체제를 동시에 운영할 때 등등.

이런 걸 가능하게 해주는 마법 같은 기능이 바로 **가상화(Virtualization)**&#xC785;니다.

가상화란 말 그대로, **물리적인 것이 아닌 ‘가짜’를 만들어 마치 진짜처럼 작동하게 만드는 기술**입니다.\
그런데 이 ‘가짜 컴퓨터’가 **진짜처럼 작동한다는 점**이 중요합니다.

{% hint style="success" %}
즉, 하나의 물리 기기에서 `여러 개의 가상 컴퓨터(VM, Virtual Machine)`가 동시에 실행될 수 있다는 뜻이죠.
{% endhint %}

가상화 기능은 PC나 서버 등의 물리적인 기기에서 가상 머신을 동작시키는 소프트웨어\
기능 및 그런 동작을 돕는 하드웨어 기능의 조합

### 2) 왜 가상화가 필요했을까?

가상 머신은 단순히 재미로 만든 게 아닙니다. 분명한 **목적과 필요**가 있었기 때문이죠:

#### 💡 가상 머신 활용 목적

1. **하드웨어 최대 활용**
   * 하나의 서버에서 여러 시스템 운영 → 자원 낭비 ↓
   * 머신 1대     에 가상 머신을 여러 개 만들고, 각각의 가상 머신을 고객이 빌려 쓰는 `IaaS(Infrastructure as a Service)`가 그 예
2. **서버 통합**
   * 수십 대의 서버 → 몇 대의 가상 머신으로 대체 가능
3. **레거시 시스템 수명 연장**
   * 오래된 OS도 새 기기에서 실행 가능 (지원 종료돼도 OK)
4. **크로스 운영체제 사용**
   * 윈도우 안에서 리눅스를, 리눅스 안에서 윈도우를 실행 가능
5. **개발 및 테스트 환경 분리**
   * 실환경을 흉내 낸 테스트 환경을 손쉽게 구성 가능
6. **자동화 테스트 및 배포**
   * 커널 개발, CI/CD 시스템에 활용

요즘 개발자들이 가상 머신을 많이 사용하는 이유도 여기에 있죠.

> "윈도는 써야 하지만, 리눅스 커널도 만져야 하고… 둘 다 필요해!"

### 3) 가상 머신의 구성 – 어떻게 만들어지나?

가상 머신을 가능하게 해주는 중심에는 바로 **가상화 소프트웨어(Virtualization Software)**&#xAC00; 있습니다.\
이 친구가 물리 기기의 자원을 잘게 나누고, 각각의 가상 머신에 배분해주는 역할을 하죠.

#### 📦 가상화 소프트웨어는 이렇게 생겼어요

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

가상 머신 입장에서는 **CPU, 메모리, 저장장치가 모두 자신만의 것처럼 보입니다.**\
하지만 실제로는 **물리 자원의 일부만을 쓰고 있는 것**이죠.

* 물리 CPU → PCPU (Physical CPU)
* 가상 CPU → VCPU (Virtual CPU)

{% hint style="danger" %}
"진짜 CPU는 하나지만, 가상 머신에는 각각 CPU가 할당된 것처럼 보인다!"
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

가상화 소프트웨어와 가상 머신의 관계는 커널의 프로세스 관리 시스템과 프로세스의 관계와\
무척 닮았습니다.

🖼️ 그림 설명: 가상화 소프트웨어 구조

**💡 전체 구조 요약**

```
[물리 기기] ──▶ [가상화 소프트웨어] ──▶ [가상 머신]
```

가상화 소프트웨어는 물리 기기의 자원을 일정 부분 나눠서 가상 머신에게 할당해주는 역할을 합니다.\
가상 머신 입장에선 자신만의 자원을 쓰는 것처럼 느끼게 되는 것이죠.

#### ✅ 구성 요소별 설명

| 항목                      | 설명                                                        |
| ----------------------- | --------------------------------------------------------- |
| **PCPU (Physical CPU)** | 물리 기기에 실제로 장착된 CPU. 가상 머신에서 요청하는 작업을 실행하는 실제 하드웨어         |
| **VCPU (Virtual CPU)**  | 가상 머신에 제공되는 CPU. 실제론 PCPU를 시간 단위로 쪼개어 배정한 것               |
| **메모리**                 | 물리 기기 전체 메모리 중 일부를 잘라서 가상 머신에 제공. 가상 머신은 자기 메모리라고 생각함     |
| **저장 장치**               | HDD, SSD 등의 저장 장치. 이 역시 일부만 가상 머신이 사용하게끔 나눠줌              |
| **가상화 소프트웨어**           | 이 모든 자원 분배를 제어하는 '매니저'. 사용자는 여러 VM을 만들고, 각각 원하는 만큼 자원을 배분 |

#### 🔁 작동 방식 요약

1. **물리 CPU(PCPU)**&#xB294; **가상 CPU(VCPU)**&#xC5D0;게 **일부 처리 능력**을 나눠줍니다.\
   → 여러 가상 머신이 같은 CPU를 시간 단위로 번갈아 사용해요.
2. **메모리**도 마찬가지로, 실제 메모리에서 일부 구간을 잘라서 가상 머신에 제공해요.\
   → 각 가상 머신은 자신이 ‘고유 메모리’를 가진 줄 압니다.
3. **저장 장치**도 파티션처럼 나눠서 가상 머신에 제공합니다.\
   → 이게 바로 가상 하드디스크(Virtual Disk, .vmdk 등)의 개념이에요.



**🧠 핵심 이해 포인트**

* **가상 머신은 실제 자원을 100% 가진 게 아니다!**\
  → 가상화 소프트웨어가 일부만 ‘할당’해서 진짜처럼 보이게 해주는 것일 뿐
* **가상 머신은 독립된 컴퓨터처럼 보이지만**,\
  실제로는 하나의 물리 기기 안에서 돌아가는 ‘논리적 컴퓨터’입니다.
* **가상화 소프트웨어는 운영체제의 커널처럼** 자원을 나눠 쓰게 해주는 관리자 역할을 합니다.

**🧩 비유로 쉽게 이해하기**

이 구조를 "공유 오피스"에 비유하면 이렇습니다:

| 항목        | 비유                                       |
| --------- | ---------------------------------------- |
| 물리 기기     | 공유 오피스 전체 건물                             |
| PCPU      | 건물 안에 있는 회의실 (한 개뿐)                      |
| VCPU      | 각 팀이 예약해서 쓰는 회의 시간 (10~~11시, 11~~12시...) |
| 메모리       | 각 팀에게 배정된 책상 수                           |
| 저장 장치     | 각 팀에게 배정된 사물함 공간                         |
| 가상 머신     | 독립된 스타트업 팀 (각자 자기 공간인 줄 알고 씀)            |
| 가상화 소프트웨어 | 공유 오피스 관리자, 공간과 자원을 배정해줌                 |

**🔚 요약**

* 그림 10-02는 가상화 소프트웨어가 **물리 자원을 가상 머신에 할당하는 구조**를 시각화한 것입니다.
* 이 구조 덕분에 우리는 하나의 물리 컴퓨터에서 여러 개의 운영체제와 프로그램을 동시에 실행할 수 있습니다.
* 실제 자원은 나누어 쓰는 것이며, 가상 머신은 '진짜처럼 착각하도록' 정교하게 설계된 가짜 컴퓨터입니다.

### 4) 가상 머신은 어떻게 OS를 실행하는가?

우리가 컴퓨터에 리눅스를 설치하는 구조와 거의 같습니다.

#### 💻 일반적인 구조 - 물리 기기에 os를 설치한 경우

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

#### 🧩 가상 머신 위의 구조는? -  가상 머신에OS 설치한 경우

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

이처럼 가상화 소프트웨어 위에 \[그림 10-03]에서 봤던 시스템이 올라가는 구조가 됩니다. 가상 머신과 물리 기기는 장치 구성 등 일부를 제외하면 차이가 없으므로 **가상 머신이 제공하는 각종 하드웨어를 지원하는 OS가 있으면 뭐든지 설치할 수 있습니다.**

즉, 각 가상 머신 위에 원하는 **게스트 OS**를 설치하고, 그 안에서 진짜 컴퓨터처럼 동작하게 하는 겁니다.

**가상 소프프트웨어를 구현하는 방법**

* 하드웨어에 직접 하이퍼바이저  &#x20; hypervisor 가상화 소프트웨어를 설치하는 방법
* 기존 OS를 바탕으로 애플리케이션으로 동작하는  &#x20;방법
* 유명한 소프트웨어
  * VM웨어VMware 사의 각종 제품
  * 오라클Oracle 사의 버추얼박스VirtualBox
  * 마이크로소프트 Microsoft 사의 하이퍼-VHyper-V
  * 시트릭스 시스템즈Citrix Systems 사의 젠x

### 5) 가상화 소프트웨어의 3종 세트

이번 장에서는 **리눅스 기반의 오픈소스 가상화 환경**을 다루고 있습니다. 대표 구성은 이렇습니다:

| 소프트웨어            | 역할                              |
| ---------------- | ------------------------------- |
| **KVM**          | 리눅스 커널에 통합된 가상화 기능              |
| **QEMU**         | 하드웨어(특히 CPU) 에뮬레이터 역할           |
| **virt-manager** | GUI로 가상 머신 생성, 삭제, 조작 (QEMU 관리) |

이 조합은 실제로 기업 환경에서도 많이 쓰이며, 완전히 무료로 사용 가능합니다.

> 리눅스에선 `sudo apt install virt-manager` 한 줄이면 세팅 가능!

### 6) 가상 머신은 프로세스다? – 리눅스 커널이 바라보는 가상 머신

QEMU나 virt-manager는 결국 **리눅스 프로세스**입니다.\
즉, **리눅스 입장에서는 가상 머신도 그냥 실행 중인 프로그램 하나**인 거예요.

* `ps aux`로 보면 QEMU가 떡하니 떠 있음
* `top`으로 보면 CPU 자원도 쓰고 있음

그러면 궁금해지죠?

> “이 QEMU가 어떻게 리눅스, 윈도 같은 OS를 실행할 수 있는 걸까?”

그건 바로 **KVM의 도움** 덕분입니다.

* QEMU는 하드웨어를 흉내 내고,
* KVM은 CPU 실행을 하드웨어 수준에서 빠르게 처리합니다.

#### 💡 요약

* virt-manager: 가상 머신 정의 및 관리
* QEMU: 실행자
* KVM: 성능 최적화를 위한 가속기

### 7) 호스트 OS와 게스트 OS

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

| 용어         | 의미                           |
| ---------- | ---------------------------- |
| **호스트 OS** | 가상화 소프트웨어가 설치된 OS (실제 리눅스 등) |
| **게스트 OS** | 가상 머신 안에 설치된 운영체제            |

<mark style="color:red;">게스트 OS는 자신이 가상 머신 위에 있다는 걸</mark> **몰라도 됩니다.**\
자신만의 CPU와 메모리를 가지고 있다고 믿죠.

그런데 실제로는…

* CPU는 나눠쓴다 (스케줄링)
* 메모리도 나눠쓴다
* 입출력도 가상 장치를 통해 공유된다

> 즉, "분리된 듯 연결된 상태"에서 각 가상 머신이 돌아가는 거죠.

### 8) virt-manager는 ‘가짜 손’이다

virt-manager는 마치 **가상의 손처럼** 행동합니다.

* 가상 머신을 **켜고 끄고**,
* 마우스와 키보드 입력을 **전달하고**,
* CD/DVD 장치를 **마운트하거나 꺼내는** 일도 할 수 있어요.

즉, **실제 사람이 컴퓨터를 조작하는 것처럼**\
→ virt-manager가 그걸 대신해주는 거예요.

{% hint style="success" %}
virt-manager와 QEMU는 리눅스 커널 입장에서는 그저 **프로세스에 불과**합니다. 따라서 가상\
화 소프트웨어와 함께 일반적인 프로세스를 실행합니다.
{% endhint %}

```
┌──────────────┐
│ virt-manager  │ ← 마우스/키보드, 화면 출력 연결
│              │
│    QEMU      │ ← 가상 머신 실제 실행
└──────────────┘
```

#### 🔁 전체 흐름 순서

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

1. **virt-manager가 가상 머신 설계도 작성**

* 사용자에게 GUI를 제공하여 가상 머신의 사양을 설정함
  * CPU 개수
  * 메모리 용량
  * 디스크 이미지(.qcow2)
  * 네트워크 구성
  * ISO 이미지 삽입 등



2. &#x20;**virt-manager가 QEMU 프로세스를 기동**

* 사용자가 '가상 머신 시작' 버튼을 누르면,
* QEMU가 백그라운드에서 새로운 가상 머신 인스턴스를 실행함



3. &#x20;**QEMU와 KVM이 함께 가상 머신을 실행**

* **QEMU**: CPU 에뮬레이션, 하드웨어 장치 흉내
* **KVM**: CPU 가상화를 리눅스 커널 수준에서 직접 실행 (속도 빠름)



4. &#x20;**virt-manager가 전원 관리 및 삭제 기능 수행**

* 사용자가 끄기/재시작/삭제 버튼을 누르면 QEMU와 커널에 요청을 전달

#### 🧠 각 구성 요소의 역할

| 구성 요소            | 설명                                            |
| ---------------- | --------------------------------------------- |
| **virt-manager** | 사용자가 가상 머신을 쉽게 만들고 관리하도록 도와주는 GUI 툴           |
| **QEMU**         | CPU, I/O, 네트워크 등 가상 하드웨어를 '에뮬레이션'해주는 프로그램     |
| **KVM**          | 리눅스 커널 안에서 동작하는 고속 가상화 엔진 (QEMU와 연결해서 성능을 높임) |

> 💡 virt-manager는 그냥 GUI일 뿐, 실제 실행은 QEMU/KVM이 합니다.

그림 10-06은 다음과 같은 구조를 보여줍니다:

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

#### 🔧 virt-manager의 주요 기능 요약

| 기능           | 설명                                       |
| ------------ | ---------------------------------------- |
| 디스플레이 출력 보기  | 가상 머신 내부 화면을 GUI로 보여줌                    |
| 키보드/마우스 조작   | 마우스, 키보드 이벤트를 가상 머신으로 전달                 |
| 전원 켜기/끄기/재시작 | 가상 머신의 전원 상태 관리                          |
| 장치 추가/삭제     | 디스크, 네트워크, USB 등 장치를 가상 머신에 동적으로 붙이거나 제거 |
| ISO 삽입/제거    | 가상 CD/DVD 드라이브에 이미지 삽입 또는 추출             |

#### 📌 핵심 요약

* **virt-manager**는 사용자와 QEMU/KVM 사이의 ‘조정자’입니다.
* 실제 가상 머신은 **QEMU + KVM** 조합으로 실행됩니다.
* 이 조합은 **직접 명령어로 조작할 수도 있고**, **virt-manager로 간편하게 제어할 수도 있어요**.
* 모든 동작은 결국 리눅스에서 돌아가는 **하나의 프로세스처럼 취급됩니다**.



### 9) Nested Virtualization – 가상 머신 안의 가상 머신

> "가상 머신 안에서도 가상 머신을 만들 수 있을까?"

네, 요즘은 가능합니다! 이걸 `중첩 가상화(nested virtualization)`라고 합니다.

특히 **클라우드 환경에서 많이 쓰입니다.**

* 예: Google Cloud 위에 리눅스 가상 머신 생성
* 그 리눅스 가상 머신에서 또 다른 리눅스/윈도 설치

하지만…

* 하이퍼바이저(가상화 엔진)가 중첩 가상화를 **지원해야** 합니다
* 성능도 다소 떨어질 수 있습니다

> “클라우드 속 가상 머신 안에서 또 다른 클라우드를 띄운다”\
> 요즘 DevOps 환경에서 테스트나 CI/CD용으로 자주 사용됩니다.

### ✅ 마무리: 가상은 진짜가 될 수 있다

가상 머신은 이제 단순한 실험 도구를 넘어, **진짜 운영 환경의 핵심 인프라**로 자리잡았습니다.

* 클라우드? = 가상 머신의 제국
* 서버 통합? = 가상화 없인 불가능
* 테스트 환경 구축? = 가상 머신이 없으면 너무 불편

이 모든 걸 가능하게 하는 건, OS와 커널이 만들어내는 **철저한 격리와 가상화 기술** 덕분입니다.

> 진짜처럼 보이는 가짜,\
> 그러나 실제보다 더 유용한 그 무엇.

이것이 가상화의 매력이자, 우리가 반드시 알아야 할 시스템의 세계입니다.
