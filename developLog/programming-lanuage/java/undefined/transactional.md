# Transactional

"트랜잭셔널이 빠져있다 => 정확성은 어떡하냐"라는 말은 주로 **트랜잭션(@Transactional)** 처리가 빠졌을 때 데이터의 일관성과 무결성에 대한 우려를 나타내는 표현입니다. 이를 이해하려면, 트랜잭션의 개념과 왜 이를 사용하는지에 대한 배경을 아는 것이 중요합니다.

#### 1. 트랜잭션(@Transactional)이란?

* **트랜잭션**은 데이터베이스 작업을 하나의 논리적인 작업 단위로 묶는 개념입니다. 여러 개의 작업이 하나의 트랜잭션 안에서 처리되며, 모든 작업이 성공해야만 최종적으로 커밋(commit)되고, 하나라도 실패하면 롤백(rollback)되어 작업이 취소됩니다.
* 트랜잭션이 중요한 이유는 \*\*데이터의 무결성(integrity)\*\*과 \*\*일관성(consistency)\*\*을 보장하기 위함입니다.

#### 2. 트랜잭션의 주요 특징 (ACID)

트랜잭션은 데이터베이스의 **ACID** 속성을 통해 데이터 정확성과 무결성을 보장합니다:

* **Atomicity (원자성)**: 트랜잭션 내의 모든 작업은 전부 성공하거나, 하나라도 실패하면 전부 취소됩니다. 즉, 트랜잭션의 작업은 하나의 단위로 처리됩니다.
* **Consistency (일관성)**: 트랜잭션이 성공적으로 완료되면, 데이터베이스는 일관된 상태로 유지됩니다. 즉, 트랜잭션 전후의 데이터 상태는 항상 일관성을 가집니다.
* **Isolation (고립성)**: 동시에 실행되는 트랜잭션이 서로 간섭하지 않도록 보장합니다.
* **Durability (지속성)**: 트랜잭션이 성공적으로 완료되면 그 결과는 영구적으로 저장됩니다.

#### 3. `@Transactional`의 역할

스프링에서는 데이터베이스 트랜잭션을 관리하기 위해 `@Transactional` 어노테이션을 제공합니다. 이 어노테이션은 메서드나 클래스에 적용되어 해당 범위에서 트랜잭션이 활성화되고, 모든 데이터베이스 작업이 성공하면 커밋되며, 실패 시 롤백됩니다.

#### 4. "트랜잭셔널이 빠져있다 => 정확성은 어떡하냐"의 의미

이 말은 코드에서 트랜잭션을 처리하는 **`@Transactional` 어노테이션이 적용되지 않았을 때**, 다음과 같은 문제들이 발생할 수 있음을 우려하는 것입니다:

1. **원자성 보장이 어려움**: 트랜잭션이 적용되지 않으면 여러 개의 데이터베이스 작업이 하나의 작업 단위로 처리되지 않습니다. 그 결과, 중간에 오류가 발생해도 이전에 완료된 작업은 되돌아가지 않고 데이터가 불완전한 상태로 남을 수 있습니다. 예를 들어, 은행 송금 중에 송금은 되었지만 인출이 실패하는 상황이 발생할 수 있습니다.
2. **데이터 일관성 문제**: 여러 개의 작업이 하나의 트랜잭션 내에서 처리되지 않으면, 일부 작업이 완료된 상태에서 다른 작업이 실패하면 데이터베이스에 일관성이 깨질 수 있습니다. 트랜잭션 없이 데이터베이스를 조작하면 시스템 내에서 데이터의 불일치가 생길 수 있습니다.
3. **롤백 불가**: 트랜잭션 없이 예외가 발생하면 실패한 부분만 복구될 수 없고, 중간 상태에서 작업이 멈출 수 있습니다. 트랜잭션은 실패 시 전체 작업을 되돌려 무결성을 유지하지만, 트랜잭션이 없다면 이를 보장할 방법이 없습니다.
4. **동시성 문제**: 트랜잭션이 없다면 여러 사용자가 동시에 같은 데이터를 조작할 때, 충돌이 발생하거나 데이터가 손상될 수 있습니다. 트랜잭션은 동시성 문제를 해결하는데 필수적인 역할을 합니다.

#### 5. 예시: 트랜잭션이 빠졌을 때의 문제

```java
public void transferMoney(Long fromAccountId, Long toAccountId, BigDecimal amount) {
    // 출금
    accountRepository.debit(fromAccountId, amount);
    // 입금
    accountRepository.credit(toAccountId, amount);
}
```

위와 같은 메서드가 있다고 가정해 봅시다. 여기서 `debit`은 출금을, `credit`은 입금을 처리합니다. 트랜잭션이 없다면 다음과 같은 상황이 발생할 수 있습니다:

* 출금(debit)이 성공했지만 입금(credit)이 실패했을 때, 돈이 한 계좌에서만 빠져나가고 다른 계좌로는 들어가지 않는 문제가 발생할 수 있습니다. 트랜잭션이 없다면 실패한 작업을 되돌릴 방법이 없기 때문에 데이터가 불완전한 상태로 남게 됩니다.

이를 트랜잭션을 적용하여 해결할 수 있습니다:

```java
@Transactional
public void transferMoney(Long fromAccountId, Long toAccountId, BigDecimal amount) {
    accountRepository.debit(fromAccountId, amount);
    accountRepository.credit(toAccountId, amount);
}
```

이제 트랜잭션이 적용된 경우, `debit` 또는 `credit` 중 하나라도 실패하면 전체 작업이 롤백되고, 데이터의 무결성과 일관성이 보장됩니다.

#### 6. 결론

"트랜잭셔널이 빠져있다 => 정확성은 어떡하냐"는 말은 트랜잭션이 없는 상황에서 데이터 정확성과 무결성에 대한 우려를 표현한 것입니다. `@Transactional`이 없다면, 여러 데이터베이스 작업 중 하나가 실패할 때 롤백이 이루어지지 않아 데이터가 불완전하거나 일관성이 깨질 위험이 있습니다. 따라서 트랜잭션은 데이터 처리의 정확성을 보장하기 위해 매우 중요한 역할을 하며, 특히 중요한 데이터베이스 작업에서는 필수적으로 사용됩니다.
